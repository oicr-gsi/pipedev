#!/bin/sh

if [ "$#" -ne 2 ]; then
  echo "Workflow accession (parameter 1) and study name (parameter 2) needs to be set"; 
  exit 1;
fi

SEQWARE_DISTRIBUTION=${SEQWARE_DISTRIBUTION:-$(readlink -f target/Workflow_Bundle_OneStepWorkflow_*/Workflow_Bundle_OneStepWorkflow/*/lib/seqware-distribution-*.jar)}
DECIDER_JAR=${DECIDER_JAR:-$(readlink -f target/Decider_1.3_OneStepWorkflow_*_SeqWare_*-jar-with-dependencies.jar)}

WORKFLOW_ACCESSION=$1
STUDY_NAME=$2

java -cp "${SEQWARE_DISTRIBUTION}":"${DECIDER_JAR}" net.sourceforge.seqware.pipeline.runner.PluginRunner --plugin ca.on.oicr.pde.workflows.Decider -- \
--wf-accession "${WORKFLOW_ACCESSION}" \
--study-name "${STUDY_NAME}" \
--script `pwd`/target/Workflow_Bundle_OneStepWorkflow_1.3_SeqWare_1.0.10/Workflow_Bundle_OneStepWorkflow/1.3/bin/jobs.sh \
--commit-version `head -1 ../.git/refs/heads/master` \
--test
